var __async=(__this,__arguments,generator)=>new Promise((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())});import{r as reactExports,j as jsxRuntimeExports,f as Container,h as Typography,G as Grid,P as Paper,B as Box,i as TextField,g as Button,H as y}from"./react-mui-core-CD28kaIJ.js";import{a as useCart,u as useAuth}from"./index-DUyuosf6.js";import{A as API}from"./api-CPHjYns6.js";import{S as SEO}from"./SEO-DB5lEH1m.js";function Checkout(){const{state,dispatch}=useCart(),{cartItems}=state,{user,token}=useAuth(),[name,setName]=reactExports.useState((null==user?void 0:user.name)||""),[email,setEmail]=reactExports.useState((null==user?void 0:user.email)||""),[address,setAddress]=reactExports.useState(""),[submitted,setSubmitted]=reactExports.useState(false),totalPrice=cartItems.reduce((sum,item)=>sum+item.price*item.qty,0),handleSubmit=e=>__async(this,null,function*(){var _a,_b;e.preventDefault();if(!name||!email||!address)return y.error("Please fill all fields");if(!cartItems.length)return y.error("Your cart is empty");const orderItems=cartItems.map(item=>({product:item._id,qty:item.qty,price:item.price})),shippingAddress={name,email,address};try{yield API.post("/orders",{orderItems,shippingAddress,paymentMethod:"Cash on Delivery",totalPrice},{headers:{Authorization:`Bearer ${token}`}});dispatch({type:"CLEAR_CART"});setSubmitted(true);y.success("Order placed successfully!")}catch(err){y.error((null==(_b=null==(_a=err.response)?void 0:_a.data)?void 0:_b.message)||"Order could not be placed")}}),handleStripeCheckout=()=>__async(this,null,function*(){var _a,_b,_c;if(!name||!email||!address)return y.error("Please fill all fields");if(!cartItems.length)return y.error("Your cart is empty");try{const items=cartItems.map(item=>({_id:item._id,title:item.title,price:item.price,qty:item.qty,description:item.description||item.title})),shippingAddress={name,email,address},res=yield API.post("/payments/create-checkout-session",{items,shippingAddress},{headers:{Authorization:`Bearer ${token}`}});(null==(_a=res.data)?void 0:_a.url)?window.location.href=res.data.url:y.error("Could not create checkout session")}catch(err){y.error((null==(_c=null==(_b=err.response)?void 0:_b.data)?void 0:_c.message)||"Failed to initiate payment")}});return submitted?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SEO,{title:"Order Confirmed - Pulse Watches",description:"Your order has been placed successfully.",url:"https://pulsewatches.pk/checkout",noindex:true,nofollow:true}),jsxRuntimeExports.jsxs(Container,{maxWidth:"lg",sx:{py:10,textAlign:"center"},children:[jsxRuntimeExports.jsx(Typography,{variant:"h3",gutterBottom:true,children:"ðŸŽ‰ Thank You!"}),jsxRuntimeExports.jsx(Typography,{variant:"h6",color:"text.secondary",children:"Your order has been placed successfully."})]})]}):cartItems.length?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SEO,{title:"Checkout - Pulse Watches",description:"Complete your order and shipping information.",url:"https://pulsewatches.pk/checkout",noindex:true,nofollow:true}),jsxRuntimeExports.jsxs(Container,{maxWidth:"lg",sx:{py:6},children:[jsxRuntimeExports.jsx(Typography,{variant:"h4",fontWeight:800,align:"center",gutterBottom:true,children:"Checkout"}),jsxRuntimeExports.jsxs(Grid,{container:true,spacing:3,children:[jsxRuntimeExports.jsx(Grid,{item:true,xs:12,md:8,children:jsxRuntimeExports.jsxs(Paper,{sx:{p:3},children:[jsxRuntimeExports.jsx(Typography,{variant:"h6",gutterBottom:true,children:"Shipping Information"}),jsxRuntimeExports.jsxs(Box,{component:"form",onSubmit:handleSubmit,sx:{mt:2},children:[jsxRuntimeExports.jsx(TextField,{label:"Name",value:name,onChange:e=>setName(e.target.value),fullWidth:true,required:true,sx:{mb:2}}),jsxRuntimeExports.jsx(TextField,{type:"email",label:"Email",value:email,onChange:e=>setEmail(e.target.value),fullWidth:true,required:true,sx:{mb:2}}),jsxRuntimeExports.jsx(TextField,{label:"Address",value:address,onChange:e=>setAddress(e.target.value),fullWidth:true,required:true,multiline:true,minRows:3,sx:{mb:2}}),jsxRuntimeExports.jsx(Button,{type:"submit",variant:"contained",color:"primary",fullWidth:true,sx:{mb:1},children:"Place Order"}),jsxRuntimeExports.jsx(Button,{type:"button",variant:"outlined",color:"secondary",fullWidth:true,onClick:handleStripeCheckout,children:"Pay with Card"})]})]})}),jsxRuntimeExports.jsx(Grid,{item:true,xs:12,md:4,children:jsxRuntimeExports.jsxs(Paper,{sx:{p:3},children:[jsxRuntimeExports.jsx(Typography,{variant:"h6",gutterBottom:true,children:"Order Summary"}),jsxRuntimeExports.jsx(Box,{component:"ul",sx:{listStyle:"none",p:0,m:0},children:cartItems.map(item=>{var _a;return jsxRuntimeExports.jsxs(Box,{component:"li",sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1.5},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1.5,flex:1},children:[jsxRuntimeExports.jsx(Box,{component:"img",src:`/images/${null==(_a=item.images)?void 0:_a[0]}`,alt:item.title,loading:"lazy",decoding:"async",width:"56",height:"56",sx:{width:56,height:56,aspectRatio:"1/1",objectFit:"cover",borderRadius:1,display:"block",flexShrink:0}}),jsxRuntimeExports.jsxs(Typography,{variant:"body2",children:[item.title," x ",item.qty]})]}),jsxRuntimeExports.jsxs(Typography,{variant:"body2",fontWeight:700,children:["Rs. ",item.price*item.qty]})]},item._id)})}),jsxRuntimeExports.jsxs(Typography,{variant:"subtitle1",fontWeight:800,sx:{mt:2,textAlign:"right"},children:["Total: Rs. ",totalPrice]})]})})]})]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SEO,{title:"Checkout - Pulse Watches",description:"Complete your order.",url:"https://pulsewatches.pk/checkout",noindex:true,nofollow:true}),jsxRuntimeExports.jsxs(Container,{maxWidth:"lg",sx:{py:10,textAlign:"center"},children:[jsxRuntimeExports.jsx(Typography,{variant:"h3",gutterBottom:true,children:"ðŸ›’ Your cart is empty"}),jsxRuntimeExports.jsx(Typography,{variant:"h6",color:"text.secondary",children:"Add some products to proceed to checkout."})]})]})}export{Checkout as default};
