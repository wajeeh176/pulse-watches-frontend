var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:true,configurable:true,writable:true,value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__spreadProps=(a,b)=>__defProps(a,__getOwnPropDescs(b)),__async=(__this,__arguments,generator)=>new Promise((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())});import{r as reactExports,j as jsxRuntimeExports,h as Typography,B as Box,g as Button,Q as TableContainer,P as Paper,U as Table,V as TableHead,W as TableRow,X as TableCell,Y as TableBody,k as IconButton,Z as Dialog,_ as DialogTitle,$ as DialogContent,i as TextField,a0 as Tooltip,a1 as purify,a2 as ReactQuill,a3 as LinearProgress,S as Stack,F as Chip,a4 as DialogActions,H as y}from"./react-mui-core-CD28kaIJ.js";import{g as AddIcon,h as EditIcon,i as DeleteIcon,j as PreviewIcon,k as ClearIcon,l as ImageIcon,m as CloseIcon}from"./mui-icons-Bbp48fiL.js";import{A as API}from"./api-CPHjYns6.js";function AdminProducts(){const[products,setProducts]=reactExports.useState([]),[loading,setLoading]=reactExports.useState(true),[open,setOpen]=reactExports.useState(false),[editMode,setEditMode]=reactExports.useState(false),[currentProduct,setCurrentProduct]=reactExports.useState({title:"",description:"",price:"",category:"",brand:"",countInStock:"",images:[],seoTitle:"",seoDescription:"",seoKeywords:""}),[imageInput,setImageInput]=reactExports.useState(""),[generatingSEO,setGeneratingSEO]=reactExports.useState(false),[previewMode,setPreviewMode]=reactExports.useState(false),quillModules=reactExports.useMemo(()=>({toolbar:[[{header:[1,2,3,false]}],["bold","italic","underline","strike"],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],["link","image"],["clean"]]}),[]),quillFormats=reactExports.useMemo(()=>["header","bold","italic","underline","strike","blockquote","code-block","list","bullet","link","image"],[]);reactExports.useEffect(()=>{fetchProducts()},[]);const fetchProducts=()=>__async(this,null,function*(){try{const res=yield API.get("/products");setProducts(res.data||[])}catch(error){}finally{setLoading(false)}}),handleOpen=(product=null)=>{if(product){setEditMode(true);setCurrentProduct(__spreadProps(__spreadValues({},product),{seoKeywords:Array.isArray(product.seoKeywords)?product.seoKeywords.join(", "):product.seoKeywords||"",seoTitle:product.seoTitle||"",seoDescription:product.seoDescription||""}))}else{setEditMode(false);setCurrentProduct({title:"",description:"",price:"",category:"",brand:"",countInStock:"",images:[],seoTitle:"",seoDescription:"",seoKeywords:""});setImageInput("")}setOpen(true)},handleClose=()=>{setOpen(false);setCurrentProduct({title:"",description:"",price:"",category:"",brand:"",countInStock:"",images:[],seoTitle:"",seoDescription:"",seoKeywords:""});setImageInput("")},handleGenerateSEO=()=>__async(this,null,function*(){var _a,_b;try{if(!currentProduct.title&&!currentProduct.description){y.error("Please provide a title or description to generate SEO");return}setGeneratingSEO(true);const res=yield API.post("/products/generate-seo",{title:currentProduct.title,description:currentProduct.description}),{seoTitle,seoDescription,seoKeywords}=res.data||{};setCurrentProduct(prev=>__spreadProps(__spreadValues({},prev),{seoTitle:seoTitle||prev.seoTitle,seoDescription:seoDescription||prev.seoDescription,seoKeywords:Array.isArray(seoKeywords)?seoKeywords.join(", "):seoKeywords||prev.seoKeywords}));y.success("SEO generated successfully")}catch(error){y.error((null==(_b=null==(_a=error.response)?void 0:_a.data)?void 0:_b.message)||"Failed to generate SEO")}finally{setGeneratingSEO(false)}}),handleSave=()=>__async(this,null,function*(){var _a,_b;try{const payload=__spreadProps(__spreadValues({},currentProduct),{price:""!==currentProduct.price?Number(currentProduct.price):void 0,countInStock:""!==currentProduct.countInStock?Number(currentProduct.countInStock):void 0});if(editMode){yield API.put(`/products/${currentProduct._id}`,payload);y.success("Product updated successfully!")}else{yield API.post("/products",payload);y.success("Product added successfully!")}handleClose();fetchProducts()}catch(error){y.error((null==(_b=null==(_a=error.response)?void 0:_a.data)?void 0:_b.message)||"Failed to save product")}}),handleDelete=id=>__async(this,null,function*(){var _a,_b;if(window.confirm("Are you sure you want to delete this product?"))try{yield API.delete(`/products/${id}`);y.success("Product deleted successfully!");fetchProducts()}catch(error){y.error((null==(_b=null==(_a=error.response)?void 0:_a.data)?void 0:_b.message)||"Failed to delete product")}}),handleChange=e=>{const{name,value}=e.target;setCurrentProduct(prev=>__spreadProps(__spreadValues({},prev),{[name]:value}))},handleAddImage=()=>{if(imageInput.trim()){setCurrentProduct(prev=>__spreadProps(__spreadValues({},prev),{images:[...prev.images,imageInput.trim()]}));setImageInput("")}},handleRemoveImage=index=>{setCurrentProduct(prev=>__spreadProps(__spreadValues({},prev),{images:prev.images.filter((_,i)=>i!==index)}))};return loading?jsxRuntimeExports.jsx(Typography,{children:"Loading..."}):jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[jsxRuntimeExports.jsx(Typography,{variant:"h4",fontWeight:800,children:"Products"}),jsxRuntimeExports.jsx(Button,{variant:"contained",color:"primary",startIcon:jsxRuntimeExports.jsx(AddIcon,{}),onClick:()=>handleOpen(),children:"Add Product"})]}),jsxRuntimeExports.jsx(TableContainer,{component:Paper,children:jsxRuntimeExports.jsxs(Table,{children:[jsxRuntimeExports.jsx(TableHead,{children:jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(TableCell,{children:jsxRuntimeExports.jsx("strong",{children:"Title"})}),jsxRuntimeExports.jsx(TableCell,{children:jsxRuntimeExports.jsx("strong",{children:"Brand"})}),jsxRuntimeExports.jsx(TableCell,{children:jsxRuntimeExports.jsx("strong",{children:"Category"})}),jsxRuntimeExports.jsx(TableCell,{children:jsxRuntimeExports.jsx("strong",{children:"Price"})}),jsxRuntimeExports.jsx(TableCell,{children:jsxRuntimeExports.jsx("strong",{children:"Stock"})}),jsxRuntimeExports.jsx(TableCell,{align:"right",children:jsxRuntimeExports.jsx("strong",{children:"Actions"})})]})}),jsxRuntimeExports.jsx(TableBody,{children:products.map(product=>{var _a;return jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(TableCell,{children:product.title}),jsxRuntimeExports.jsx(TableCell,{children:product.brand||"-"}),jsxRuntimeExports.jsx(TableCell,{children:product.category||"-"}),jsxRuntimeExports.jsxs(TableCell,{children:["Rs. ",null==(_a=product.price)?void 0:_a.toLocaleString()]}),jsxRuntimeExports.jsx(TableCell,{children:product.countInStock}),jsxRuntimeExports.jsxs(TableCell,{align:"right",children:[jsxRuntimeExports.jsx(IconButton,{color:"primary",onClick:()=>handleOpen(product),children:jsxRuntimeExports.jsx(EditIcon,{})}),jsxRuntimeExports.jsx(IconButton,{color:"error",onClick:()=>handleDelete(product._id),children:jsxRuntimeExports.jsx(DeleteIcon,{})})]})]},product._id)})})]})}),jsxRuntimeExports.jsxs(Dialog,{open,onClose:handleClose,maxWidth:"md",fullWidth:true,children:[jsxRuntimeExports.jsx(DialogTitle,{children:editMode?"Edit Product":"Add Product"}),jsxRuntimeExports.jsxs(DialogContent,{children:[jsxRuntimeExports.jsx(TextField,{label:"Title",name:"title",value:currentProduct.title,onChange:handleChange,fullWidth:true,margin:"normal",required:true}),jsxRuntimeExports.jsxs(Box,{sx:{mb:2},children:[jsxRuntimeExports.jsxs(Typography,{variant:"subtitle2",sx:{mb:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsx("span",{children:"Description"}),jsxRuntimeExports.jsx("span",{style:{display:"flex",gap:12,alignItems:"center"},children:jsxRuntimeExports.jsxs(Typography,{variant:"caption",color:"text.secondary",children:[(currentProduct.description||"").replace(/<[^>]+>/g,"").length," chars"]})})]}),jsxRuntimeExports.jsxs(Paper,{variant:"outlined",sx:{p:2,background:"rgb(31,34,38)",boxShadow:theme=>`0 6px 18px rgba(15,23,42,0.06)`},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Tooltip,{title:previewMode?"Exit preview":"Preview description",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=>setPreviewMode(v=>!v),children:jsxRuntimeExports.jsx(PreviewIcon,{fontSize:"small"})})}),jsxRuntimeExports.jsx(Tooltip,{title:"Clear description",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=>setCurrentProduct(prev=>__spreadProps(__spreadValues({},prev),{description:""})),children:jsxRuntimeExports.jsx(ClearIcon,{fontSize:"small"})})})]}),jsxRuntimeExports.jsx(Typography,{variant:"caption",color:"text.secondary",children:"Rich text editor — HTML will be saved. Use headings & lists."})]}),previewMode?jsxRuntimeExports.jsx(Box,{sx:{p:2,minHeight:140,borderRadius:1,background:theme=>theme.palette.background.paper},children:jsxRuntimeExports.jsx("div",{dangerouslySetInnerHTML:{__html:purify.sanitize(currentProduct.description||"")}})}):jsxRuntimeExports.jsx(Box,{sx:{".ql-toolbar":{borderRadius:"8px 8px 0 0",border:theme=>`1px solid ${theme.palette.divider}`,borderBottom:0,background:"rgb(31,34,38)",color:"#fff"},".ql-container":{minHeight:240,border:theme=>`1px solid ${theme.palette.divider}`,borderRadius:"0 0 8px 8px",boxShadow:"0 6px 18px rgba(15,23,42,0.04)",background:"rgb(31,34,38)"},".ql-editor":{minHeight:180,fontSize:15,lineHeight:"1.6",padding:"14px",color:"#ffffff",background:"transparent"},".ql-editor.ql-blank::before":{color:"rgba(255,255,255,0.6)"}},children:jsxRuntimeExports.jsx(ReactQuill,{theme:"snow",value:currentProduct.description||"",onChange:value=>setCurrentProduct(prev=>__spreadProps(__spreadValues({},prev),{description:value})),modules:quillModules,formats:quillFormats,placeholder:"Write product description here — highlight features, specs, fit, and care instructions."})}),jsxRuntimeExports.jsxs(Box,{sx:{mt:1},children:[jsxRuntimeExports.jsx(LinearProgress,{variant:"determinate",value:Math.min(100,Math.round((currentProduct.description||"").replace(/<[^>]+>/g,"").length/160*100))}),jsxRuntimeExports.jsxs(Typography,{variant:"caption",color:"text.secondary",children:["Recommended meta length: up to 160 characters. (",(currentProduct.description||"").replace(/<[^>]+>/g,"").length," chars)"]})]})]})]}),jsxRuntimeExports.jsx(TextField,{label:"SEO Title",name:"seoTitle",value:currentProduct.seoTitle,onChange:handleChange,fullWidth:true,margin:"normal"}),jsxRuntimeExports.jsx(TextField,{label:"SEO Description",name:"seoDescription",value:currentProduct.seoDescription,onChange:handleChange,fullWidth:true,margin:"normal",multiline:true,rows:2}),jsxRuntimeExports.jsx(TextField,{label:"SEO Keywords (comma separated)",name:"seoKeywords",value:currentProduct.seoKeywords,onChange:handleChange,fullWidth:true,margin:"normal",placeholder:"e.g., luxury, gold, men"}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:2,mt:1,mb:1},children:[jsxRuntimeExports.jsx(Button,{variant:"outlined",onClick:handleGenerateSEO,disabled:generatingSEO,children:generatingSEO?"Generating...":"Generate SEO"}),jsxRuntimeExports.jsx(Typography,{variant:"caption",color:"text.secondary",sx:{alignSelf:"center"},children:"Use product title & description to auto-create SEO fields."})]}),jsxRuntimeExports.jsx(TextField,{label:"Brand",name:"brand",value:currentProduct.brand,onChange:handleChange,fullWidth:true,margin:"normal"}),jsxRuntimeExports.jsx(TextField,{label:"Price",name:"price",type:"number",value:currentProduct.price,onChange:handleChange,fullWidth:true,margin:"normal",required:true}),jsxRuntimeExports.jsx(TextField,{label:"Category",name:"category",value:currentProduct.category,onChange:handleChange,fullWidth:true,margin:"normal",placeholder:"e.g., Men, Women, Luxury"}),jsxRuntimeExports.jsx(TextField,{label:"Count In Stock",name:"countInStock",type:"number",value:currentProduct.countInStock,onChange:handleChange,fullWidth:true,margin:"normal",required:true}),jsxRuntimeExports.jsxs(Box,{sx:{mt:3},children:[jsxRuntimeExports.jsx(Typography,{variant:"subtitle1",fontWeight:700,gutterBottom:true,children:"Product Images"}),jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:1,sx:{mb:2},children:[jsxRuntimeExports.jsx(TextField,{label:"Image filename (e.g., rolex.png)",value:imageInput,onChange:e=>setImageInput(e.target.value),fullWidth:true,size:"small",placeholder:"Enter image filename from /public/images/",InputProps:{startAdornment:jsxRuntimeExports.jsx(ImageIcon,{sx:{mr:1,color:"text.secondary"}})}}),jsxRuntimeExports.jsx(Button,{variant:"contained",onClick:handleAddImage,disabled:!imageInput.trim(),children:"Add"})]}),currentProduct.images.length>0&&jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography,{variant:"body2",color:"text.secondary",gutterBottom:true,children:"Added Images:"}),jsxRuntimeExports.jsx(Stack,{direction:"row",spacing:1,flexWrap:"wrap",gap:1,children:currentProduct.images.map((img,index)=>jsxRuntimeExports.jsx(Chip,{label:img,onDelete:()=>handleRemoveImage(index),deleteIcon:jsxRuntimeExports.jsx(CloseIcon,{}),color:"primary",variant:"outlined"},index))})]}),jsxRuntimeExports.jsx(Typography,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:"Note: Images should be placed in client/public/images/ folder"})]})]}),jsxRuntimeExports.jsxs(DialogActions,{children:[jsxRuntimeExports.jsx(Button,{onClick:handleClose,children:"Cancel"}),jsxRuntimeExports.jsx(Button,{onClick:handleSave,variant:"contained",color:"primary",children:editMode?"Update":"Add"})]})]})]})}export{AdminProducts as default};
